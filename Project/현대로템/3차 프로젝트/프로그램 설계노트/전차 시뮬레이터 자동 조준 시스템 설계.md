## 1. 개요
전차 시뮬레이터에서 자동 조준 시스템을 구현하고자 한다. 본 문서에서는 자동 조준의 정의와 구현 방법을 기술한다

**자동 조준 정의**: 적의 위치 또는 이동 방향을 자동으로 추적하여 타격하는 시스템

**중간 목표**:
1. 적의 위치를 향해 조준
2. 적의 이동 방향을 예측
## 2. 적 조준 방법
적을 조준하는 방법은 다음 세 가지로 분류된다:
1. 카메라 이미지에서 검출된 적 위치 활용
2. 시뮬레이션 데이터(`/info` 엔드포인트) 기반 조준
3. 이미지 데이터와 시뮬레이션 데이터를 융합

각 방법은 고유한 장단점과 한계를 지니며, 아래에서 상세히 논의한다. 본 설계는 카메라로 거리 정보를 얻을 수 없다는 가정 하에 진행된다

### 2.1. 이미지 기반 적 위치 검출
카메라 이미지를 활용한 조준은 다음과 같은 가정에서 설계된다:
- 관찰자와 적이 평면 상에 존재
- 적의 움직임은 관찰자의 시야에서 단일 축(고정 이동축, 예: 좌우 이동)으로 제한됨
![[자동 조준 메커니즘에 대한 고찰-20250430-1.png|500]]

**특징**:
- FPS 게임(예: CS:GO)의 헤드라인 조준과 유사. 적의 높이는 유효 사거리 내에서 거의 일정
- 히트스캔 방식(즉시 타격)에서는 효과적이지만, 본 시뮬레이터는 곡사 투사체를 사용하므로 추가 고려사항 발생:
  - 투사체의 비행 시간(θt)은 거리와 탄속에 따라 달라짐
  - 거리 정보 부재 시, 이미지 데이터는 조준 방향과 보정값 계산에 주로 활용
![[자동 조준 메커니즘에 대한 고찰-20250430.png|500]]

**활용 방안**:
- 이미지 데이터로 적의 고정 이동축 위치를 추적.
- 조준 방향 설정 및 미세 조정에 사용

**한계**:
- 거리 정보 부재로 인해 투사체 궤적 계산이 불완전.
- 지형지물이나 장애물 정보 미포함

### 2.2. 시뮬레이션 데이터 기반 조준
시뮬레이션의 `/info` 엔드포인트는 다음과 같은 JSON 형식의 데이터를 제공한다:

```json
{
  "time": 3.9867117404937744,
  "distance": 252.40330505371094,
  "playerPos": { "x": 60.0, "y": 8.002116203308105, "z": 27.229999542236328 },
  "playerSpeed": 0.2987206280231476,
  "playerHealth": 100.0,
  "playerTurretX": 2.9181717042803257e-09,
  "playerTurretY": 0.0,
  "playerBodyX": 2.9181717042803257e-09,
  "playerBodyY": -3.256887814995224e-11,
  "playerBodyZ": -9.338149453697042e-08,
  "enemyPos": { "x": 59.22119903564453, "y": 8.869277954101562, "z": 279.630615234375 },
  "enemySpeed": 19.135791778564453,
  "enemyHealth": 100.0,
  "enemyTurretX": 179.5301055908203,
  "enemyTurretY": -2.180685520172119,
  "enemyBodyX": 179.5301055908203,
  "enemyBodyY": 2.180685520172119,
  "enemyBodyZ": 2.2678720951080322
}
```

**활용 가능한 정보**:
1. **distance**: 적과의 거리
2. **playerPos, enemyPos**: 플레이어와 적의 3D 좌표
3. **playerSpeed, enemySpeed**: 플레이어와 적의 이동 속도
4. **playerBodyX, enemyBodyX**: 플레이어와 적의 본체 방향
5. **playerTurretX**: 플레이어 포탑의 방향

**활용 방안**:
1. **거리(distance)**:
   - 포신의 신뢰 사거리 내 오차 범위 계산
   - 포신 각도 설정
1. **플레이어 및 적 위치/속도(playerPos, enemyPos, playerSpeed, enemySpeed)**:
   - 플레이어의 로컬 좌표계 내에서 적의 상대 속도 계산
   - 고정 이동축의 단위 벡터와 속력을 활용해 적의 이동 방향 예측
1. **포탑 및 위치(playerTurretX, playerPos, enemyPos)**:
   - 적과 플레이어 좌표를 이용해 조준 헤딩 값 계산

**장점**:
- 거리 및 위치 정보를 포함하므로 투사체 궤적 계산 가능
- 이론적으로 완전한 조준 및 사격 구현 가능

**한계**:
- 지형지물 및 장애물 정보 미포함
- 데이터 지연 또는 부정확성 가능성

### 2.3. 이미지 데이터와 시뮬레이션 데이터 융합
시뮬레이션 데이터(`/info`)만으로도 조준이 가능하지만, 지형지물 및 장애물 정보를 반영하려면 카메라 이미지가 필요하다. 이는 다음과 같은 이유로 중요하다:
- **지형지물 고려**: `/info` 데이터는 지형이나 장애물 정보를 제공하지 않음
- **정확한 타격 보장**: 장애물로 인해 투사체가 목표에 도달하지 못할 가능성 배제

**융합 방안**:
1. 카메라로 적 및 지형지물 검출
2. `/info` 데이터를 활용해 적의 위치, 거리, 이동 방향 계산
3. 이미지 데이터로 장애물 존재 여부 확인 후 조준 보정

**작동과정**:
- 카메라로 적 포착 시, `/info` 데이터 기반 조준 시작
- 이미지 데이터로 장애물 확인 후 투사체 궤적 보정
- 최종적으로 조준 및 사격 실행
## 3. 결론
- **이미지 기반 조준**: 간단하지만 거리 및 지형 정보 부족으로 제한적
- **시뮬레이션 데이터 기반 조준**: 이론적으로 완전한 조준 가능하나 지형 정보 미포함
- **데이터 융합**: 지형 및 장애물 정보를 반영하여 가장 안정적이고 정확한 조준 구현 가능

따라서, 최적의 자동 조준 시스템은 이미지 데이터와 시뮬레이션 데이터를 융합하여 적의 위치, 이동 방향, 지형 조건을 종합적으로 고려하는 방식으로 설계해야 한다

[[조준 알고리즘 설계 노트]]
[[사거리에 따른 오차 선정]]